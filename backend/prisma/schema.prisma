// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Editora {
  id       Int     @id @default(autoincrement())
  nome     String
  endereco String
  livros   Livro[] // Relação: Uma editora pode ter vários livros
}

model Livro {
  ISBN               String      @id @map("isbn") // @map é opcional, mas garante o nome da coluna no DB
  titulo             String
  data_de_publicacao DateTime    @map("data_de_publicacao")
  editora_id         Int
  editora            Editora     @relation(fields: [editora_id], references: [id])
  autores            Autor[]     // Relação Muitos-para-Muitos implícita com Autor
  impressoes         Impressao[] // Relação Muitos-para-Muitos explícita com Grafica

  @@map("livros") // Mapeia o nome do model para a tabela "livros"
}

model Autor {
  RG       String  @id @map("rg")
  nome     String
  endereco String
  livros   Livro[] // Relação Muitos-para-Muitos implícita com Livro

  @@map("autor")
}

// A tabela 'Escreve' (Muitos-para-Muitos entre Livro e Autor)
// é gerenciada implicitamente pelo Prisma. Ele criará uma tabela
// de junção chamada '_AutorToLivro' automaticamente.

model Grafica {
  id         Int         @id @default(autoincrement())
  nome       String
  particular Particular? // Relação 1-para-1 opcional
  contratada Contratada? // Relação 1-para-1 opcional
  impressoes Impressao[] // Relação Muitos-para-Muitos explícita com Livro

  @@map("grafica")
}

// Modelos para a especialização de Grafica
model Particular {
  grafica_id Int     @id
  grafica    Grafica @relation(fields: [grafica_id], references: [id])

  @@map("particular")
}

model Contratada {
  grafica_id Int        @id
  endereco   String
  grafica    Grafica    @relation(fields: [grafica_id], references: [id])
  contratos  Contrato[] // Uma contratada pode ter vários contratos

  @@map("contratada")
}

model Contrato {
  id               Int        @id @default(autoincrement())
  valor            Decimal
  nome_responsavel String     @map("nome_responsavel")
  grafica_cont_id  Int
  contratada       Contratada @relation(fields: [grafica_cont_id], references: [grafica_id])

  @@map("contrato")
}

// A tabela 'imprime' é uma relação Muitos-para-Muitos com campos extras.
// Por isso, precisamos criar um modelo explícito para ela.
model Impressao {
  lisbn        String
  grafica_id   Int
  nto_copias   Int? // '?' torna o campo opcional (pode ser NULL)
  data_entrega DateTime?

  livro   Livro   @relation(fields: [lisbn], references: [ISBN])
  grafica Grafica @relation(fields: [grafica_id], references: [id])

  @@id([lisbn, grafica_id]) // Chave primária composta
  @@map("imprime")
}
